<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Combined Analytics (Applications & Scholarships)</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2em; }
      h1 { margin-top: 0; }
      form { background: #f5f7fa; padding: 1em 1.5em; border-radius: 8px; margin-bottom: 1.5em; }
      fieldset { border: 1px solid #ccc; padding: 0.75em 1em; margin-bottom: 1em; border-radius: 6px; }
      legend { font-weight: bold; }
      label { display: block; margin: 0.4em 0; }
      .inline { display: flex; gap: 1em; flex-wrap: wrap; }
      .inline > div { min-width: 180px; }
      .errors { background: #f8d7da; color: #721c24; padding: 1em; border-radius: 6px; margin-bottom: 1em; }
      .section { background: #fff; border: 1px solid #e1e4e8; padding: 1em; border-radius: 8px; margin-bottom: 1.25em; }
      pre { background: #272822; color: #f8f8f2; padding: 1em; border-radius: 6px; overflow: auto; max-height: 380px; }
      .meta { font-size: 0.9em; color: #555; margin-bottom: 0.75em; }
      .export { display: flex; gap: 0.5em; }
      button { cursor: pointer; }
      .nav a { text-decoration: none; margin-right: 1em; color: #0366d6; }
      .badge { background: #007bff; color: white; padding: 0.25em 0.5em; border-radius: 4px; font-size: 0.7em; }
    </style>
  </head>
  <body>
    <div class="nav"><a href="/">Home</a> <a href="/analytics/">Full Analytics</a></div>
    <h1>Combined Analytics</h1>
    <p>This report focuses on <strong>Application Trends</strong> and <strong>Scholarship Impact</strong>.</p>

    {% if errors %}
      <div class="errors">
        <strong>Errors:</strong>
        <ul>
          {% for e in errors %}<li>{{ e }}</li>{% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="get">
      <div class="inline">
        <div>
          <label>Start Date
            <input type="date" name="start_date" value="{{ form.start_date }}" />
          </label>
        </div>
        <div>
          <label>End Date
            <input type="date" name="end_date" value="{{ form.end_date }}" />
          </label>
        </div>
      </div>
      <fieldset>
        <legend>Export (optional)</legend>
        <label><input type="radio" name="export_format" value="json" {% if form.export_format == 'json' %}checked{% endif %}/> JSON</label>
        <label><input type="radio" name="export_format" value="excel" {% if form.export_format == 'excel' %}checked{% endif %}/> Excel (.xlsx)</label>
        <label><input type="radio" name="export_format" value="pdf" {% if form.export_format == 'pdf' %}checked{% endif %}/> PDF</label>
      </fieldset>
      <button type="submit">Generate Report</button>
    </form>

    {% if analytics %}
      <div class="section">
        <h2>Metadata</h2>
        <div class="meta">Generated: {{ analytics.metadata.generated_at }} | Period: {{ analytics.metadata.period_start }} â†’ {{ analytics.metadata.period_end }}</div>
      </div>

      {% if analytics.application_trends %}
        <div class="section">
          <h2>Application Trends <span class="badge">application_trends</span></h2>
          <pre>{{ analytics.application_trends|safe }}</pre>
        </div>
      {% endif %}

      {% if analytics.scholarship_impact %}
        <div class="section">
          <h2>Scholarship Impact <span class="badge">scholarship_impact</span></h2>
          <pre>{{ analytics.scholarship_impact|safe }}</pre>
        </div>
      {% endif %}

      <div class="section">
        <h2>Raw JSON (debug)</h2>
        <pre>{{ analytics|safe }}</pre>
      </div>
    {% endif %}
  </body>
</html>
